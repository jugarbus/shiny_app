"0","ui <- navbarPage(theme = shinytheme(""yeti""), ""App Máster Ciencia de Datos"","
"0","                 "
"0","  # Incluir archivo CSS para personalizar el estilo visual"
"0","  tags$head("
"0","    includeCSS(""www/styles.css"")  # Ruta al archivo CSS"
"0","  ),"
"0","                 "
"0","  # Pestaña para selección de máquina"
"0","  tabPanel(""Selección de máquina"", "
"0","           sidebarLayout("
"0","             sidebarPanel("
"0","               h5(""MÁQUINA""),  # Título"
"0","               fileInput(""DatosFichero"", ""Selecciona un fichero""),  # Carga de archivo"
"0","               uiOutput(""select_matricula""),  # SelectInput dinámico para la matrícula de la máquina"
"0","              ),"
"0","             mainPanel("
"0","               h5(""Probabilidad de orden""),  # Título"
"0","               plotOutput('graf1')  # Gráfico de la probabilidad de orden"
"0","             )"
"0","           )"
"0","  ),"
"0","  "
"0","  # Menú de navegación para estado de la máquina"
"0","  navbarMenu(""Estado de la máquina"","
"0","           # Pestaña para evolución temporal de las alarmas"
"0","           tabPanel(""Evolución temporal alarmas"", "
"0","                    sidebarLayout("
"0","                      sidebarPanel("
"0","                         h5(""Filtrar por estado de alarma""),  # Título"
"0","                        radioButtons(""estado_alarma1"", ""Selecciona estado de alarma"", "
"0","                                     choices = c(""Activas"" = ""activa"", ""Inactivas"" = ""inactiva"")),  # Filtrar alarmas activas o inactivas"
"0","                        h5(""Selecciona una alarma""),  # Título"
"0","                        uiOutput(""select_alarmas_radio"")  # SelectInput dinámico para elegir alarma"
"0","                      ),"
"0","                      mainPanel("
"0","                        h5(""Evolución temporal alarmas""),  # Título"
"0","                        plotlyOutput('graf2')  # Gráfico interactivo con Plotly"
"0","                      )"
"0","                    )"
"0","           ),"
"0","           # Pestaña para registros de la máquina"
"0","           tabPanel(""Registros de la máquina"", "
"0","                     sidebarLayout("
"0","                        sidebarPanel("
"0","                          h5(""Filtrar por estado de alarma""),  # Título"
"0","                          radioButtons(""estado_alarma2"", ""Selecciona estado de alarma"", "
"0","                                       choices = c(""Activas"" = ""activa"", ""Inactivas"" = ""inactiva"")),  # Filtrar alarmas activas o inactivas"
"0","                          uiOutput(""select_alarmas_check"")  # Checkboxes dinámico para seleccionar alarmas"
"0","                        ),"
"0","                        mainPanel(h5(""Registros de la máquina seleccionada""), dataTableOutput('tabla1'))  # Tabla de registros"
"0","                    )"
"0","           )"
"0","),"
"0","  "
"0"," # Pestaña para estadísticas globales temporales"
"0"," tabPanel(""Estadísticas Globales Temporales"", "
"0","         sidebarLayout("
"0","           sidebarPanel("
"0","             h5(""PERIODO Y ESTADÍSTICAS""),  # Título"
"0","             dateRangeInput('rango_fecha', label = 'Selecciona el periodo', "
"0","                            min = '2016-01-01', max = '2025-02-13', "
"0","                            start = '2016-01-02', end = '2016-12-14', "
"0","                            format = ""yyyy-mm-dd"", separator= ""a""),  # Selector de fechas"
"0","             h5(""SELECCIONAR ALARMA""),  # Título"
"0","             uiOutput(""select_alarma_hist""),  # SelectInput dinámico para seleccionar alarma"
"0","             radioButtons(""tipo_grafico"", ""Seleccionar tipo de gráfico:"", "
"0","                          choices = c(""Histograma"" = ""hist"", ""Boxplot"" = ""boxplot"")),  # Selección de tipo de gráfico"
"0","             # Panel condicional para histograma"
"0","             conditionalPanel("
"0","               condition = ""input.tipo_grafico == 'hist'"","
"0","               sliderInput(""slider1"", label = ""Número de bins del histograma"", "
"0","                           min = 1, max = 10, value = 5, step = 1)  # Control deslizante para el número de bins"
"0","             ),"
"0","             # Panel condicional para boxplot"
"0","             conditionalPanel("
"0","               condition = ""input.tipo_grafico == 'boxplot'"","
"0","               checkboxInput(""Caja1"", ""Todas las máquinas"", value = FALSE)  # Opción para mostrar boxplot de todas las máquinas"
"0","             )"
"0","           ),"
"0","           mainPanel("
"0","             # Mostrar histograma si se selecciona 'hist'"
"0","             conditionalPanel("
"0","               condition = ""input.tipo_grafico == 'hist'"","
"0","               h5(""Histograma de la alarma seleccionada""),  # Título"
"0","               plotOutput('hist1')  # Histograma"
"0","             ),"
"0","             # Mostrar boxplot si se selecciona 'boxplot'"
"0","             conditionalPanel("
"0","               condition = ""input.tipo_grafico == 'boxplot'"","
"0","               h5(""Boxplot de la alarma seleccionada""),  # Título"
"0","               plotOutput('boxplot1')  # Boxplot"
"0","             )"
"0","           )"
"0","         )"
"0",")"
"0",")"
"2","Aviso: Navigation containers expect a collection of `bslib::nav_panel()`/`shiny::tabPanel()`s and/or `bslib::nav_menu()`/`shiny::navbarMenu()`s. Consider using `header` or `footer` if you wish to place content above (or below) every panel's contents."
"0","server <- function(input, output, session) {"
"0","  "
"0","  # Reactivo para cargar el archivo .Rdata"
"0","  df_react <- reactive({"
"0","    req(input$DatosFichero)"
"0",""
"0","    extension <- tools::file_ext(input$DatosFichero$name)"
"0","    "
"0","    # Comprobar si la extensión no es .Rdata"
"0","    if (extension != ""Rdata"") {"
"0","        showModal(modalDialog("
"0","            title = ""Formato de archivo incorrecto"",  # Título del modal"
"0","            ""El archivo proporcionado debe tener la extensión .Rdata."",  # Mensaje de error"
"0","            easyClose = TRUE,"
"0","            footer = NULL"
"0","        ))"
"0","        return(NULL)  # Detener la ejecución si la extensión no es válida"
"0","    }"
"0","    "
"0","    load(input$DatosFichero$datapath)  # Cargar el archivo si es correcto"
"0","    return(Datos)  # Retornar los datos cargados"
"0","})"
"0","  "
"0","  # SelectInput dinámico para matrícula (máquina)"
"0","  output$select_matricula <- renderUI({"
"0","    datos <- df_react()"
"0","    selectInput(""Selectbox1"", ""Selecciona máquina"", choices = unique(datos$matricula))  # Seleccionar matrícula"
"0","  })"
"0","  "
"0","  # Filtrar los datos según la matrícula seleccionada"
"0","  df_maq <- reactive({"
"0","    datos <- df_react()"
"0","    req(input$Selectbox1)"
"0","    datos %>% filter(matricula == input$Selectbox1)  # Filtrar por matrícula seleccionada"
"0","  })"
"0","  "
"0",""
"0","  # Gráfico de la probabilidad de orden para la máquina seleccionada"
"0","  output$graf1 <- renderPlot({"
"0","    df_maq() %>% "
"0","      ggplot(aes(dia, p_orden, colour = p_orden)) + "
"0","      geom_point() + geom_line() + "
"0","      scale_color_gradient(low = ""blue"", high = ""red"") + "
"0","      labs(title = ""Evolución de la probabilidad de orden"", x = ""Día"", y = ""Probabilidad de orden"") +"
"0","      theme_minimal()"
"0","  })"
"0",""
"0","  # Selección dinámica de alarma en base al estado (activa/inactiva)"
"0","  output$select_alarmas_radio <- renderUI({"
"0","    datos <- df_maq()"
"0","    req(input$estado_alarma1)"
"0","    "
"0","    if (input$estado_alarma1 == ""activa"") {"
"0","      alarmas <- names(datos)[grep('^a.', names(datos))] %>% "
"0","        Filter(function(col) any(datos[[col]] == 1, na.rm = TRUE), .)  # Filtrar alarmas activas"
"0","    } else {"
"0","      alarmas <- names(datos)[grep('^a.', names(datos))] %>% "
"0","        Filter(function(col) all(datos[[col]] == 0, na.rm = TRUE), .)  # Filtrar alarmas inactivas"
"0","    }"
"0","    "
"0","    radioButtons(""radiobuttons1"", ""Selecciona la alarma a visualizar"", choices = alarmas)  # Crear botones de radio con las alarmas"
"0","  })"
"0",""
"0","  # Selección dinámica de alarmas para la tabla"
"0","  output$select_alarmas_check <- renderUI({"
"0","    datos <- df_maq()"
"0","    req(input$estado_alarma2)"
"0","    "
"0","    if (input$estado_alarma2 == ""activa"") {"
"0","      alarmas <- names(datos)[grep('^a.', names(datos))] %>% "
"0","        Filter(function(col) any(datos[[col]] == 1, na.rm = TRUE), .)  # Filtrar alarmas activas"
"0","    } else {"
"0","      alarmas <- names(datos)[grep('^a.', names(datos))] %>% "
"0","        Filter(function(col) all(datos[[col]] == 0, na.rm = TRUE), .)  # Filtrar alarmas inactivas"
"0","    }"
"0","    "
"0","    checkboxGroupInput(""GrupoCajas1"", ""Selecciona las alarmas para ver en la tabla"", choices = alarmas, inline = FALSE)  # Crear checkboxes"
"0","  })"
"0",""
"0","  # Gráfico de la alarma seleccionada en ""Evolución temporal alarmas"""
"0","  output$graf2 <- renderPlotly({"
"0","    datos <- df_maq()"
"0","    req(input$radiobuttons1)  # Asegurar que se ha seleccionado una alarma"
"0","    "
"0","    datos_filtrados <- datos %>% filter(!is.na(.data[[input$radiobuttons1]]))  # Filtrar datos no nulos"
"0","    "
"0","    p <- ggplot(datos_filtrados, aes(x = dia, y = .data[[input$radiobuttons1]])) + "
"0","      geom_point() + "
"0","      geom_line() +"
"0","      theme_minimal() +"
"0","      labs(title = ""Gráfico de Alarma"", x = ""Día"", y = input$radiobuttons1)"
"0","    "
"0","    ggplotly(p)  # Convertir a gráfico interactivo con plotly"
"0","  })"
"0",""
"0","  # Mostrar la tabla de registros según la máquina seleccionada y las alarmas"
"0","  output$tabla1 <- renderDataTable({"
"0","    req(df_react(), input$Selectbox1, input$GrupoCajas1)"
"0","    subset(df_react(), matricula == input$Selectbox1, select = c(""matricula"", ""dia"", input$GrupoCajas1, ""p_orden""))  # Filtrar y mostrar la tabla"
"0","  })"
"0",""
"0","  # SelectInput dinámico para seleccionar la alarma en el histograma o boxplot"
"0","  output$select_alarma_hist <- renderUI({"
"0","    datos <- df_react()"
"0","    alarmas <- grep('^a.', colnames(datos), value = TRUE)  # Filtrar alarmas por nombre"
"0","    selectInput(""Selectbox2"", ""Alarma"", choices = alarmas)  # Crear SelectInput para elegir alarma"
"0","  })"
"0",""
"0","  # Datos reactivos para el histograma o boxplot"
"0","  datos_alarma <- reactive({"
"0","    req(input$Selectbox2, input$rango_fecha)"
"0","    df_maq() %>% "
"0","      filter(dia >= input$rango_fecha[1], dia <= input$rango_fecha[2]) %>%  # Filtrar por fechas"
"0","      select(.data[[input$Selectbox2]]) %>% "
"0","      drop_na()  # Eliminar valores faltantes"
"0","  })"
"0",""
"0","  # Renderizar histograma"
"0","  output$hist1 <- renderPlot({"
"0","    req(input$Selectbox2, input$rango_fecha)"
"0","    datos <- datos_alarma()"
"0","    "
"0","    ggplot(datos, aes(x = .data[[input$Selectbox2]])) + "
"0","      geom_histogram(binwidth = diff(range(datos[[input$Selectbox2]]))/input$slider1, "
"0","                     fill = ""steelblue"", color = ""black"", alpha = 0.7)"
"0","  })"
"0",""
"0","  # Renderizar boxplot"
"0","  output$boxplot1 <- renderPlot({"
"0","    req(input$rango_fecha, input$Selectbox2)"
"0","    datos <- df_react() %>%"
"0","      filter(dia >= input$rango_fecha[1], dia <= input$rango_fecha[2]) %>%"
"0","      select(matricula, dia, .data[[input$Selectbox2]]) %>%"
"0","      drop_na()"
"0","    "
"0","    if (input$Caja1) {"
"0","      ggplot(datos, aes(x = matricula, y = .data[[input$Selectbox2]])) + "
"0","        geom_boxplot(fill = ""steelblue"", color = ""black"", alpha = 0.7) +"
"0","        labs(title = paste(""Boxplots de"", input$Selectbox2, ""para todas las máquinas""), "
"0","             x = ""Máquina"", y = input$Selectbox2) +"
"0","        theme_minimal() +"
"0","        theme(axis.text.x = element_text(angle = 90, hjust = 1))"
"0","    } else {"
"0","      datos %>% ggplot(aes(y = .data[[input$Selectbox2]])) + "
"0","        geom_boxplot(fill = ""steelblue"", color = ""black"", alpha = 0.7) +"
"0","        labs(title = paste(""Boxplot de"", input$Selectbox2, ""para la máquina seleccionada""), "
"0","             x = """", y = input$Selectbox2) +"
"0","        theme_minimal()"
"0","    }"
"0","  })"
"0","  "
"0","}"
"0",""
"0","# Ejecutar la aplicación Shiny"
"0","shinyApp(ui, server)"
"2","
Listening on http://127.0.0.1:3906
"
